---
title: "CSF.Ind Shiny-based App: PDF Report"
author: "University of Molise & Forwards (ForestWard Observatory) project"
date: "`r Sys.Date()`"
params:
    fig_map: NA 
    dt_table: [some object]
    dt_table_ad: [some object]
    fig_heatmap: NA
    fig_pie_charts: NA
    fig_bar_boxplot: NA
    type: NA
output: 
  rmarkdown::pdf_document:
    fig_caption: yes        
    includes:  
      in_header: preamble-latex.tex
css: styles.css  #
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = FALSE,
               out.width = "75%", 
               fig.align = "center")
```

```{r  dodge-st, fig.show = "hold", out.width = 100}
fig1 = "C:/Users/calvi/OneDrive/Desktop/App_Forwards/R/Logo/forwards_logo_png.png"
fig2 = "C:/Users/calvi/OneDrive/Desktop/App_Forwards/R/Logo/unimol_logo_png.png"
include_graphics(fig1)
include_graphics(fig2)
```

# CSF-Ind Shiny App

## Developer and Maintainer

Cesar Alvites (Post-doc researcher at University of Molise)

## Overview

The Climate Smart Forestry (CSF) Indicators Generator (CSF-Ind) is a user-friendly Shiny web app designed to calculate CSF indicators using forest inventory data (e.g., field surveys or remote/proximal sensing forest inventory data) at tree, plot or stand levels. The app allows users to select an indicator from the two CSF pillars (Bowditch et al., 2020; Verkerk et al., 2020) and configure the analysis for one or more plots. When provided with the required data, the app generates outputs organized by forest management intensity, forest types, and other options. It is particularly useful for forestry technicians, stakeholders, researchers, and the public who are not familiar with climate-smart forestry assessment. CSF-Ind calculates indicators aligned with the mitigation and adaptation pillars of CSF. The generated output is specific to a given time, and when computed across multiple periods, it can be used to create composite maps of the CSF indicators. 
Link GIT Framework: https://github.com/Cesarito2021/CSF-Ind.git


```{r  fig.show = "hold", out.width = 200,fig.cap="Climate Smart Forestry (CSF) pillars.",fig.pos="htbp"}
fig3 = "C:/Users/calvi/OneDrive/Desktop/App_Forwards/R/Logo/csf.png"
include_graphics(fig3)

```

## Objective 

The primary objective of the CSF-Ind Shiny web app is to enable users to calculate CSF indicators without prior coding knowledge, using robust procedures already validated with data collected within the Forwards project. The app supports decision-makers in forest management under Sustainable Forest Management (SFM) criteria by aligning with CSF concept. 

## Framework

The current version of the CSF-Ind Shiny web app investigates CSF indicators belong to mitigation and adaption CSF pillars (Bowditch et al., 2020):

1) Mitigation - the Shiny web app uses forest inventory allometric equations to calculate growing, carbon stock, standing and lying deadwood volume for European forests. The current version implements R scripts based on allometric equations from the Italian National Forest Inventory (NFI) (Federici et al., 2008; Tabacchi et al., 2011). Although the current version is limited to Italian allometric equations, future updates will include national allometric equations from other European countries, allowing users to modify the equations as needed. The analysis can be performed for a single plot or multi-plots, which can be configured using a slider button.

2) Adaptation - the Shiny web app uses spatial diversity indicator formulas to evaluate the structural and species diversity within forest stands. The current version implements R scripts for calculating indices such as Stand density index, modified Vertical Evenness Index modified,Total Diameter Diversity (5cm by class), Total Height Diversity (2m  by class), Shannon, Simpson, Gini, standard deviation, coefficient of variation, and complexity indices (DÄƒnescu et al., 2016). Although the current version calculates only eleven indices per forest stand, future updates will incorporate additional structural and species diversity indices from various Forwards partners. The analysis can be performed for a single plot or multi-plots, which can be configured using a slider button. 

Although the CSF-Ind Shiny web app investigates three CSF pillars, this report focuses solely on the output of the first CSF pillar, Mitigation (Table 1).

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(openxlsx)
library(kableExtra)

  # Read the Excel file
 tab <- read.xlsx("C:/Users/calvi/OneDrive/Desktop/App_Forwards/R/Base/Base_mitigation.xlsx")
 kbl(tab,longtable = TRUE, booktabs = TRUE,align = "cccc",caption = "Climate Smart Forestry (CSF) indicators monitored by CSF-Ind Shiny web app. (*) and (**) indicates the Mitigation and Adaptation CSF Pillars")%>%
   kable_styling(full_width = F,position = "center",latex_options = c("scale_down"))%>%
   row_spec(2,extra_css = "border-bottom: 1px solid;") %>% 
   collapse_rows(columns =1:2,row_group_label_position = "first",valign = "middle")%>% 
   column_spec(1,border_right=T, bold = T, color = "#1488CA",width = "14em",latex_valign = "m")%>% 
   column_spec(2,border_right=T, width = "14em",latex_valign = "m")%>% 
   column_spec(3,border_right=T,width = "14em",latex_valign = "m")%>% 
  # #column_spec(4,width = "11em",latex_valign = "m")%>% 
   #add_header_above(c("Climate Smart Forestry (CSF) concept"= 4),bold=T)#%>%
   kable_paper()%>%
  scroll_box(width = "100%")



```
\clearpage

# Report 

## CSF - Mitigation and Adaptation pillar

## Geographic location of study area

The study area location analyzed by the CSF-Ind Shiny web app in relation to the European Zone is displayed in Figure 2. This geographical context is crucial for understanding the spatial placement of the study area and the origin of NFI allometric equation, as shown in Figure 2).

```{r, echo=FALSE,fig.width = 16, fig.asp = 0.6, fig.align = "center",fig.cap="Location of the study area in relation to the Euoropean Zone Map. The country is highlighted in deep green color.",fig.pos="htbp"}
plot(params$fig_map)

```
\clearpage
## Output Data Table 

### Data table for ForManInt (Forest Management Intensity)

This section presents the output, grouped by ForManInt types, as generated by the CSF-Ind Shiny web app (Table 2).

```{r echo=FALSE, warning=FALSE, message=FALSE}
selected_columns <- params$dt_table_ad[, 1:min(7, ncol(params$dt_table_ad))]
knitr::kable(head(selected_columns), format = "markdown", align = "c", caption = "This table shows the first 'n' rows of the first 7 columns of the generated data.")
```

### Data table for Plots

This section presents the output, grouped by Plot types, as generated by the CSF-Ind Shiny web app (Table 3).

```{r echo=FALSE, warning=FALSE, message=FALSE}
#data <- params$dt_table_ad
selected_columns <- params$dt_table[, 1:min(7, ncol(params$dt_table))]
knitr::kable(head(selected_columns),format = "markdown",align = "c",caption = "This table shows the first 'n' rows of the first 7 columns of the generated data.")
```
\clearpage
## Output Figures

### Bar/Boxplot graph of numeric data from the ForManInt output (for both Single and Multi-Plots analysis)

It is important to note that this section shows a bar graph for Single Plot analysis and a boxplot for Multi-plots analysis in the Shiny web app. The bar graph highlights patterns in the data from a single plot (Figure 3). The boxplot illustrates the distribution of data across multiple plots. This visual representation provides useful information for identifying patterns, outliers, and the overall spread of the data (Figure 3)

```{r,echo=FALSE, echo=FALSE, fig.width = 14, fig.asp = 0.85,  fig.align = "center",  fig.cap="Bar/Boxplot graph of numeric variables from output variables.",fig.pos="htbp", cex.axis=4, cex.lab=4,cex.main = 4}
params$fig_bar_boxplot + 
  theme(
    axis.text.x = element_text(size=20),
    axis.text.y = element_text(size=20),
    text = element_text(size=20),
    axis.text = element_text(size=20),          # Axis text size
    axis.title = element_text(size=20),         # Axis title size
    plot.title = element_text(size=20),         # Plot title size
    legend.text = element_text(size=20),        # Legend text size
    legend.title = element_text(size=20),       # Legend title size
    strip.text = element_text(size=20, face = "bold")#,  # Facet label text size
    #plot.margin = margin(10, 10, 10, 10)          # Optional: Add some margin around the plot
  )
```

### Pie chart of categorical data from the ForManInt output (only for multi-plot analysis and Adaptation CSF Indicator)

This section shows a Pie-Chart of categorical variables (Figure 4). The pie chart illustrates the proportions of different categories within each categorical variable (i.e., ForManInt: Forest Management Intensity)

```{r,echo=FALSE, echo=FALSE,fig.width = 12, fig.asp = 0.65, fig.align = "center",  fig.cap="Pie-Chart graph of categorical variables from output variables.",fig.pos="htbp", cex.axis=4, cex.lab=4,cex.main = 4}
if (params$type=="adaptation") {
  paste("No Pie chart figure is available to display") 
} else if(params$type=="mitigation") {
  params$fig_pie_charts+
  theme(
    axis.text.x = element_text(size=20),
    axis.text.y = element_text(size=20),
    text = element_text(size=20),
    axis.text = element_text(size=20),          # Axis text size
    axis.title = element_text(size=20),         # Axis title size
    plot.title = element_text(size=20),         # Plot title size
    legend.text = element_text(size=20),        # Legend text size
    legend.title = element_text(size=20),       # Legend title size
    strip.text = element_text(size=20, face = "bold")#,  # Facet label text size
    #plot.margin = margin(10, 10, 10, 10)          # Optional: Add some margin around the plot
  )
}
```

### Correlation Heatmap graph of numeric data from the Plots output (only for multi-plots analysis)

The heatmap results show correlation coefficients ranging from -1 to 1, where shades of blue indicate negative correlations and shades of yellow indicate positive correlation(Figure 4 or Figure 5).

```{r,echo=FALSE, echo=FALSE,fig.width = 14, fig.asp = 0.85, fig.align = "center",  fig.cap=" Correlation heatmap graph of numeric variables from generated data.",fig.pos="htbp", cex.axis=4, cex.lab=4,cex.main = 4}
if (!is.null(params$fig_heatmap)) {
  params$fig_heatmap + 
  theme(
    axis.text.x = element_text(size=20),
    axis.text.y = element_text(size=20),
    text = element_text(size=20),
    axis.text = element_text(size=20),          # Axis text size
    axis.title = element_text(size=20),         # Axis title size
    plot.title = element_text(size=20),         # Plot title size
    legend.text = element_text(size=20),        # Legend text size
    legend.title = element_text(size=20),       # Legend title size
    strip.text = element_text(size=20, face = "bold")#,  # Facet label text size
   # plot.margin = margin(10, 10, 10, 10)          # Optional: Add some margin around the plot
  )
} else {
  paste("No Figure 5 is available to display")  
}

```

\clearpage
# Acknowledgements 

This research was supported by the ForestWard Observatory to Secure Resilience of European Forests (FORWARDS) project funded by The European Unionion (https://forwards-project.eu/). 

## Reference

- Bowditch, E., Santopuoli, G., Binder, F., Del Rio, M., La Porta, N., Kluvankova, T., ... & Tognetti, R. (2020). What is Climate-Smart Forestry? A definition from a multinational collaborative process focused on mountain regions of Europe. Ecosystem Services, 43, 101113.
- DÄƒnescu, A., Albrecht, A. T., & Bauhus, J. (2016). Structural diversity promotes productivity of mixed, uneven-aged forests in southwestern Germany. Oecologia, 182(2), 319-333. 
- Federici, S., Vitullo, M., Tulipano, S., De Lauretis, R., & Seufert, G. (2008). An approach to estimate carbon stocks change in forest carbon pools under the UNFCCC: the Italian case. iForest-Biogeosciences and Forestry, 1(2), 86.
- Tabacchi, G., Di Cosmo, L., & Gasparini, P. (2011). Aboveground tree volume and phytomass prediction equations for forest species in Italy. European Journal of Forest Research, 130(6), 911-934.
- Verkerk, P. J., Costanza, R., HetemÃ¤ki, L., Kubiszewski, I., Leskinen, P., Nabuurs, G. J., ... & PalahÃ­, M. (2020). Climate-smart forestry: the missing link. Forest Policy and Economics, 115, 102164.